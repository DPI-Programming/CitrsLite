@inject NavigationManager NavigationManager
@inject CitrsLite.Business.Services.ParticipantService participantService
@using CitrsLite.Business.ViewModels.ParticipantViewModels;
@using CitrsLite.Data.Models
@using CitrsLite.Business.Enums

<MudTable Class="mt-3" Items="@Participants" Dense="true"
          Filter= "new Func<Participant,bool>(FilterFunc1)">
    <ToolBarContent>
        <MudText Typo="Typo.h6">Participant List</MudText>
        <MudSpacer />
      @*<MudTextField @bind-Value="searchString1" Placeholder="Quick Search" 
                      Adornment="Adornment.Start" AdornmentIcon="@Icons.Material.Filled.Search"
                      IconSize="Size.Medium" Class="mt-0">
        </MudTextField>*@
    </ToolBarContent>
    <HeaderContent>
        <MudTh>Name</MudTh>
        <MudTh>Type</MudTh>
        <MudTh>City</MudTh>
        <MudTh>Description</MudTh>
        <MudTh>Details</MudTh>
    </HeaderContent>
    <RowTemplate>
        <MudTd DataLabel="Name">@context.Name</MudTd>
        <MudTd DataLabel="Type">@context.Type</MudTd>
        <MudTd DataLabel="City">@context.City</MudTd>
        <MudTd DataLabel="Description">@context.Description</MudTd>
        <MudTd DataLabel="Details">
            <MudButton Href=@("/participant/detail/" + context.Id.ToString())
                       Variant="Variant.Text"
                       EndIcon="@Icons.Material.Filled.Link"
                       Color="Color.Primary">
            </MudButton>
        </MudTd>
    </RowTemplate>
    <PagerContent>
        <MudTablePager />
    </PagerContent>
</MudTable>

@code {
    private IEnumerable<Participant> Participants = new List<Participant>();
    private string? searchString1 = "";
    private bool _sortNameByLength;
    [Parameter]
    public ParticipantDetailViewModel? searchQuery { get; set; }
    //private bool isQuickSearchUsed = false;

    protected override async Task OnInitializedAsync()
    {
        Participants = await participantService.GetListAsync();
    }

    private bool SearchParticipant(Participant participant, ParticipantDetailViewModel searchQuery)
    {
        if (searchQuery.Name == null || participant.Name.Contains(searchQuery.Name, StringComparison.OrdinalIgnoreCase))
            return true;


        return false;
    }

    //private bool FilterFunc1(Participant participant) => FilterFunc2(participant);
    private bool FilterFunc1(Participant participant) => SearchParticipant(participant, searchQuery);
    private bool FilterFunc(Participant participant, string searchString)
    {
        if (string.IsNullOrWhiteSpace(searchString))
            return true;
        if (participant.Name.Contains(searchString, StringComparison.OrdinalIgnoreCase))
            return true;
        if (participant.Type.ToString().Replace("_", " ").Contains(searchString, StringComparison.CurrentCultureIgnoreCase))
            return true;
        if ($"{participant.PhoneNumber} {participant.Address} {participant.Id} {participant.City} {participant.State} {participant.Description}"
            .Contains(searchString))
            return true;
        return false;
    }
}
